clear; clc; clf; close all;
format shortg
warning off
%%
guess = 0.1;
x_values = 60*[0.210255017	0.540636008	0.827478419	1.024682577	1.168103782	1.257742035	1.329452638	1.419090891	1.478849727	1.544584446	1.616295049	1.723860953	1.777643905	1.849354508	1.90313746	1.992775713	2.064486316	2.136196919	2.189979871	2.261690473	2.333401076	2.42303933	2.476822282	2.548532884	2.638171138	2.727809391	2.817447644	2.925013549	3.032579453	3.140145357	3.247711261	3.373204816	3.516626021	3.660047226	3.821396083	4.000672589	4.179949096	4.395080904	4.628140363	4.879127473	5.183897534	5.524522897	5.901003561	6.295411876	6.689820191	7.084228506	7.478636821	7.873045136	8.267453451	8.661861766	9.056270081	9.450678396	9.845086711	10.23949503	10.63390334	11.02831166	11.38686467];
y_values = [0.008367216	0.016812313	0.038665572	0.057938207	0.078344526	0.096244806	0.114145086	0.139354648	0.155912407	0.181271137	0.202303967	0.230944415	0.250783892	0.275545946	0.294937917	0.323876703	0.346848729	0.37071577	0.389809402	0.410842231	0.430085032	0.454548749	0.472598198	0.494078534	0.515708039	0.540171756	0.56344212	0.588204174	0.611772877	0.636236593	0.657120253	0.678898927	0.702318461	0.723425874	0.744771959	0.765894289	0.785226592	0.806502354	0.825382887	0.844029012	0.864266274	0.884394144	0.904116999	0.921773184	0.938127531	0.950983187	0.960584246	0.968476642	0.974741741	0.979949095	0.983935975	0.987678761	0.99236538	0.995435549	0.995462671	0.996628901	0.997921699];
d = 10;
fun = @(D,x) 1 - 2*exp(-D(1)*pi^2*x_values/d^2) + 2*exp(-4*D(1)*pi^2*x_values/d^2) - 2*exp(-9*D(1)*pi^2*x_values/d^2) + 2*exp(-16*D(1)*pi^2*x_values/d^2) - 2*exp(-25*D(1)*pi^2*x_values/d^2);
[best_fit, residual] = lsqcurvefit(fun, guess, x_values, y_values);

%%
figure
a1 = plot(x_values, y_values, 'ko', 'MarkerFaceColor', 'w', 'MarkerSize', 10);
hold on
a2 = plot(x_values, fun(best_fit), 'r-', 'LineWidth' , 2);
D = best_fit
ylim([0 1])

%% Triangles
guess2 = [0.001 0.25];
x = [0.168983051	0.166271186	0.168983051	0.126271186	0.100169492];
y = [8.657534247	8.917808219	9.089041096	9.561643836	10.01369863];

fun2 = @(D,s) -D(1)*(x) + 1./D(2);
[best_fit2, residual2] = lsqcurvefit(fun2, guess2, x, y);


figure
plot(x,y,'k^')
hold on
a2 = plot(x, fun2(best_fit2), 'r-', 'LineWidth' , 1);
xlim([0 0.2])
ylim([8,12])

slope = best_fit2(1)
D = best_fit2(2)
dx = slope*D

fun3 = @(q) -slope*(q) + 1/D;
f = linspace(0,0.1);
p = fun3(f);

%% Circles
guess3 = [0.001 0.25];
x_1 = [0.16559322	0.126271186];
y_1 = [10.73287671	10.95890411];

fun6 = @(D,v) -D(1)*(x_1) + 1./D(2);
[best_fit3, residual3] = lsqcurvefit(fun6, guess3, x_1, y_1);

figure
plot(x_1,y_1,'ko')
hold on
a2 = plot(x_1, fun6(best_fit3), 'r-', 'LineWidth' , 1);
xlim([0 0.2])
ylim([8,12])

slope_1 = best_fit3(1)
D_1 = best_fit3(2)
dx_1 = slope_1*D_1

fun4 = @(u) -slope_1*(u) + 1/D_1;
w = linspace(0,x_1(2));
r = fun4(w);

%% Final Plot
figure
% ezplot(fun3)
plot(x,y,'k^')
hold on
plot(x, fun2(best_fit2), 'k-', 'LineWidth' , 1);
plot(f,p, 'k--')
plot(x_1,y_1,'ko')
plot(x_1, fun6(best_fit3), 'k-', 'LineWidth' , 1);
plot(w,r, 'k--')

xlim([0 0.2])
ylim([8,12])